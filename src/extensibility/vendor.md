# ベンダ固有レイア

このレイヤは、メモリマップドレジスタと割り込み、ペリフェラルのマッピング、そして
場合によってはDSO（Drone Serial Output）の実装で構成されます。このセクションでは、
ベンダ固有レイヤの例として、`drone-nrf-map`と`drone-nrf91-dso`クレートを概観
します。

## バインディング

クレートの`drone-nrf-map`コレクションは純粋に宣言的なものです。ベンダ提供の
CMSIS-SVDファイルから可能な限り多くのコードを自動的に生成するようにしています。
メモリマップドレジスタバインディングの生成は高度に並列化されています。そのため、`drone-nrf-map-pieces-1`から`drone-nrf-map-pieces-12`までの名前を持つ
12個のクレートに分割され、Cargoによって並列にコンパイルされます。
`drone-nrf-map-pieces-*`クレートはすべて単一の`drone-nrf-map-pieces`
クレートにより再エクスポートされており、ペリフェラルバインディグで使用する
ことができます。

すべてのバインディングが自動生成できるわけではありません。手作業でも[ペリフェラル
マッピング](../periph.md)を宣言しています。コンパイルを並列処理するために、
各ペリフェラルの型はそれ自身のクレート（たとえば、`drone-nrf-map-periph-uarte`）
で宣言されています。ペリフェラルクレートはオプトインであり、`drone-nrf-map`
クレートの対応するcargo featureをアクティブにすることにより有効にします。

最後に、`drone-nrf-map-pieces`と`drone-nrf-map-periph-*`クレートはすべて
`drone-nrf-map`クレートによって再エクスポートされています。

## DSO（Drone Serila Output）

nRF9160の場合のようにターゲットが通常のハードウェアロギングを実装していない場合、
ソフトウェアロギングの実装を提供します。これは特別なDSO（Drone Serial Output）
プロトコルを使用してハードウェアSWOと同等な機能を提供しています。DSOは出力を異なる
ポートに分割し、アトミックパケットを形成するものです。

`drone-nrf91-dso`の実装は、ソフトウェア出力FIFOに基づいており、内蔵の汎用UART
ペリフェラルの1つを利用します。
